function getParameter(e,t){var n=t||document.location.search,i=new RegExp("[?&]"+e+"=([^&]+)","g"),a=i.exec(n),s=null;return null!=a&&(s=decodeURIComponent(a[1])),s}function receiveCoupon(e,t){$.ajax({type:"get",dataType:"jsonp",url:webCtx+"/coupon/jsonp/direct?couponUuid="+e+"&comeFrom=vivoshop_pc",success:function(e){e&&600==e.retCode?LoginConfirm.redirect():e&&200==e.retCode?(new Dialog({title:"领券成功",content:e.retMsg,confirmBtn:!0}),t.closest(".card-coupon-item").addClass("card-coupon--received").end().remove()):new Dialog({title:"领券失败",content:e.retMsg,confirmBtn:!0}),conponDoing=!1},error:function(){new Dialog({title:"领券失败",content:"领券失败，请稍候重试",confirmBtn:!0}),conponDoing=!1}})}function reserveSubmit(e,t,n){var i=3==e?"登记":"预约",a=$("#reserveWarp"),s=a.find(".err-tip"),o=a.find(".phone"),r=a.find(".btn");o.prop("disabled",!0),$.ajax({type:"get",url:webCtx+"/product/freeAppoint?t="+ +new Date,data:{appointType:e,skuId:window.checkedSkuId,mobilephone:t},success:function(e){o.prop("disabled",!1),r.text("确认").removeClass("disabled"),e&&200==e.retCode?(n.hide(),$(n.$El).remove(),new Dialog({icon:"success",title:i+"成功",content:"我们会在到货的第一时间提醒您",confirmBtn:!0,confirmText:"关闭"}),o.val(""),r.addClass("disabled")):s.text(e.retMsg)},error:function(){n.hide(),$(n.$El).remove(),new Dialog({icon:"warning",title:i+"失败",content:"网络错误，请稍候重试",confirmBtn:!0}),o.prop("disabled",!1),r.text("确认").removeClass("disabled")}})}function initRecommendEvent(){function e(){$("#scroll-ul .box").each(function(e){$(this).css({left:e*b})}),setTimeout(function(){p()},500)}function t(){$("#prod-recommend .tab-item").click(function(){$(this).hasClass("active")||o($(this).attr("name"))})}function n(){$("#j_right-action").click(function(){if($(this).hasClass("disabled"))return!1;var e=c(),t=d($("#"+e+"-last"))+b-I;t>I?l(I):0===t?r()||"parts"!==e||o("similar"):l(t)})}function i(){return $(this).hasClass("disabled")?!1:void $("#j_left-action").click(function(){var e=c(),t=d($("#"+e+"-first"));-I>=t?l(-I):0===t?r()||"similar"!==e||o("parts"):l(t)})}function a(){$(window).on("scroll",function(){var e=$("#prod-recommend"),t=e.isOnScreen();t||(isDownRecommend=1),t&&isDownRecommend&&(h(!0),isDownRecommend=0)})}function s(){$("#scroll-ul .box").click(function(){Vtrack.clickStats({cfrom:"5341",sku_id:window.checkedSkuId,module:g(),recommand_id:$(this).data("skuid"),position:$(this).data("position")})})}function o(e){$("#prod-recommend .tab-item").removeClass("active"),$("#j_product-tab-"+e).addClass("active");var t=d($("#"+e+"-first"));l(t)}function r(){return 1===$("#prod-recommend .tab-item").length}function c(){return"j_product-tab-parts"===$("#prod-recommend .recommend-tab .active").attr("id")?"parts":"similar"}function d(e){return parseInt(e.css("left"))}function l(e){$("#scroll-ul .box").each(function(){var t=d($(this));$(this).css({left:t-e})}),u()}function u(){setTimeout(function(){p(),h()},500)}function p(){f(),m()}function f(){d($("#scroll-ul .box:last"))<=3*b?$("#j_right-action").addClass("disabled"):$("#j_right-action").removeClass("disabled")}function m(){0===d($("#scroll-ul .box:first"))?$("#j_left-action").addClass("disabled"):$("#j_left-action").removeClass("disabled")}function h(e){var t=[];$("#scroll-ul .box").each(function(){var n=d($(this));if(0===n||n===b||n===2*b||n===3*b){var i=$(this).data("skuid"),a=$(this).data("position");(e||!k(w,i))&&t.push({cfrom:"5340",sku_id:window.checkedSkuId,module:g(),recommand_id:i,position:a})}}),w=t,v()}function v(){for(var e=0;e<w.length;e++)Vtrack.clickStats(w[e])}function g(){var e={parts:1,similar:2};return e[c()]}function k(e,t){for(var n=!1,i=0;i<e.length;i++)if(e[i].recommand_id===t){n=!0;break}return n}var b=255,I=1020,w=[];e(),n(),i(),t(),a(),s()}function previewFixed(){var e,t,n=0,i=$(".prod-container-left"),a=i.outerHeight(!0),s=$(".prod-container").offset().top,t=$(".prod-container").outerHeight(!0),o=0,r=!1;$(window).on({scroll:function(){o=$(this).scrollLeft(),e=$(this).scrollTop(),t=$(".prod-container").outerHeight(!0),t+s>e+a?(n=Math.max($(".prod-container-left").offset().top-e,20),$("#prod-container-left").css({position:"fixed",top:n,left:r?-o:$(".prod-container-left").offset().left})):(n=t-a,$("#prod-container-left").css({position:"absolute",top:n,left:0}))},resize:function(){r=document.documentElement.clientWidth<1200,$(this).trigger("scroll")}}).trigger("resize")}function isShortage(e){var t=spuInfo.downSkuIds.concat(spuInfo.noStoreSkuIds);return t.indexOf(+e)>=0||!$(".primary-info[skuId="+checkedSkuId+"]").hasClass("btnChangeAble")}function initChedkedSpecs(){var e=$(".spec-container .spec-item-value.on");e.each(function(){var e=$(this).closest(".spec-item"),t=e.attr("specId"),n=$(this).attr("specItemId"),i=$(this).attr("specItemName");checkedSpecMap[t]={specItemId:n,specItemName:i}})}function refreshSpecState(){for(var e=$(".spec-container"),t=spuInfo.specInfo.specMain.map(function(e){return checkedSpecMap[e]&&checkedSpecMap[e].specItemId||""}),n=chooseSpec(t,spuInfo.specInfo.skuSpecList),i=0,a=n.length;a>i;i++)if(0!=i){var s=n[i],o=spuInfo.specInfo.specMain[i],r=e.find('.spec-item[specId="'+o+'"]');r.find(".spec-item-value").each(function(){s.indexOf($(this).index()+1+"")<0?$(this).addClass("disabled"):$(this).removeClass("disabled")});var c=r.find(".on");if(c&&c.hasClass("disabled")){c.removeClass("on"),delete checkedSpecMap[o],r.prev(".spec-name").find(".tip").show(),refreshSpecState();break}}}function refreshSpecStoreState(){var e=spuInfo.specInfo.skuSpecList.filter(function(e){return spuInfo.noStoreSkuIds.concat(spuInfo.downSkuIds).indexOf(e.skuId)<0}),t=$(".spec-container"),n=spuInfo.specInfo.specMain.map(function(e){return checkedSpecMap[e]&&checkedSpecMap[e].specItemId||""}),i=chooseSpec(n,e);i.forEach(function(e,n){if(!(0==n&&$(".spec-item").length>1)){var i=spuInfo.specInfo.specMain[n],a=t.find('.spec-item[specId="'+i+'"]');a.find(".spec-item-value").each(function(){return $(this).hasClass("disabled")?$(this).removeClass("shortage"):void(e.indexOf($(this).index()+1+"")<0?$(this).addClass("shortage"):$(this).removeClass("shortage"))})}})}function refreshInfo(e){if(e){SKU.getParams(),$("#salePrice").val($(".primary-info[skuId="+checkedSkuId+"]").attr("salePrice")),refreshImgCat(e),refreshCollectState(),$(".primary-info[skuId="+e+"]").show().siblings(".primary-info").hide(),$(".sku-service[skuId="+e+"]").show().siblings(".sku-service").hide(),SKU.data.isEarnest?($("#installment_dt, #j_installment").hide(),$(".server-support [data-id=detail0]").hide()):vvsDetailskuInstallment.viewHtml(),refreshMaxNum(),$("#add-num").val(1),$(".prod-main-information .section[skuId="+e+"]").show().siblings(".section").hide(),$("#J_Share .section[skuId="+e+"]").show().siblings(".section").hide(),$(".prod-main-parameter .prod-parameters-section[skuId="+e+"]").show().siblings(".prod-parameters-section").hide(),$(".j_normalBtns[skuId="+e+"]").show().siblings(".j_normalBtns").hide();var t=$(".j_normalBtns[skuId="+e+"] .btn-next"),n=$(".prod-amount-fixed .btn-next");n.removeClass().addClass("btn--sm btn-next "+t.attr("btnClass")).attr("title",t.attr("title")).show().siblings().hide(),n.find(".btn-inner").text(t.attr("title"));var i=$(".primary-info[skuId="+e+"]").attr("skuName");$(".thumb-goods-des h3.pull-left").attr("title",i).html(i),$(".j_activity_btns").hide(),$(".j_btnsLaser").hide(),$(".j_btnLaser-sm").addClass("hidden"),LaserUtil.initView(e),choiceTotal()}}function initSwitch(){var e=$("#smallImgUl ul").eq(0),t=e.find("li").outerWidth(!0),n=e.find("li").size(),i=0;n>4?(e.width(t*n),0==i?$(".figure-btn-l").addClass("figure-btn-disabled"):$(".figure-btn-l").removeClass("figure-btn-disabled"),n%4==i?$(".figure-btn-r").addClass("figure-btn-disabled"):$(".figure-btn-r").removeClass("figure-btn-disabled"),$(".figure-btn-wrap").removeClass("hidden"),$(".figure-btn-wrap").on("click","a",function(){var a=$(this).index();1==a?(i++,i=Math.min(i%n,n-4)):(i--,i=Math.max(0,i)),e.stop(!0).animate({left:-i*t},300,function(){0==i?$(".figure-btn-l").addClass("figure-btn-disabled"):$(".figure-btn-l").removeClass("figure-btn-disabled"),n%4==i?$(".figure-btn-r").addClass("figure-btn-disabled"):$(".figure-btn-r").removeClass("figure-btn-disabled")})})):$(".figure-btn-wrap").addClass("hidden"),$("#j_SpecItems").on("mouseenter","li",function(){return $(this).hasClass("current")?!1:($(this).addClass("current").siblings().removeClass("current"),$("#j_smallPic").length&&($("#j_smallPic")[0].src=$(this).children("a").children("img")[0].src),$("#j_SpecImgs li").eq($(this).index()).css({display:"block",opacity:0,zIndex:9}).stop().animate({opacity:1},800).siblings().css({zIndex:1}).stop().animate({opacity:0},500,function(){$(this).css({display:"none"})}),!1)}),$("#j_SpecItems li").first().trigger("mouseenter")}function refreshCollectState(){var e=$("#j_CollectTrigger").parent();SPU.skuFavouriteList.indexOf(checkedSkuId)<0?e.removeClass("collected"):e.addClass("collected")}function refreshImgCat(e){var t=$("#bigImgUl"),n=$("#smallImgUl");t.empty(),n.empty();var i=document.createElement("ul");i=$(i).addClass("cl"),$errorMsg.empty();var a=spuInfo.skuImageJson[e];$(".prod-corner-icon").css("background-image","url("+a.corner||")"),a.bigImage.forEach(function(e){t.append("<li><img src="+e+' alt="商品图片" /></li>')}),a.smallImage.forEach(function(e){i.append('<li><a href="javascript:;" ><img src='+e+" /></a></li>")}),n.append(i),initSwitch(),function(){var e=n.find("li").size()>1?1:0,t=n.find("li").eq(e).find("img").attr("src");$(".main-prod").find("img").attr("src",t)}()}function refreshMaxNum(){maxNumberPerUser=SKU.data.isEarnest?depositMaxNum:SPU.secondBuy?secondByMaxNum:normalMaxNum,$("#order-num-msg").text("(仅限购"+maxNumberPerUser+"件)")}function combUId(){var e=[];return spuInfo.specInfo.specMain.forEach(function(t){e.push(checkedSpecMap[t].specItemId)}),e.join("-")}function isCompleteSpec(){var e=!0;return spuInfo.specInfo.specMain.forEach(function(t){checkedSpecMap[t]&&checkedSpecMap[t].specItemId||(e=!1)}),e}function chooseSpec(e,t){for(var n=saleProp.length,i=new Array(n),a=0;n>a;a++){var s=saleProp[a];i[a]=[];for(var o=0;o<salePropSeq[s].length;o++){var r=o+1+"";i[a].push(r)}}for(var a=0;n>a;a++){for(var c=saleProp[a],d=[],l=0;l<t.length;l++){for(var u=!0,o=0;n>o;o++){var p=saleProp[o];if(c!==p&&e[o]&&t[l].sequences[p]!=e[o]){u=!1;break}}u&&d.push(t[l].sequences[c]+"")}i[a]=[].intersect(i[a],d)}return i}function changeSuiteSkuPic(e){var t=e.find("span.selected").attr("imgsrc");e.parents(".J_bundle_sku_box").find(".ap-img").attr("src",t)}function prodBtns(){$("body").on("click",".add-cart",function(){var e=$(this);if(e.hasClass("btn-disabled")||e.hasClass("btn--wait"))return!1;if(isCompleteSpec()){e.addClass("btn--wait");var t=getProductParams(!0),n=t.num;isNaN(n)&&(n=1),n=n>maxNumberPerUser?maxNumberPerUser:n,n=1>n?1:n,$.ajax({type:"POST",url:webCtx+"/shoppingcart/cartAdd",data:$.param({skuId:t.skuId,num:n,sSkuIds:t.sSkuIds,bSkuIds:t.bSkuIds,suiteCode:t.suiteCode},!0),success:function(t){if(200==t.retCode&&($errorMsg.hide(),$document.trigger("updateShopcartNum"),location.href=webCtx+"/shoppingcart/cartAddSuccess"),200!=t.retCode)if(t.retMsg.match("^{(.+:.+,*){1,}}$")){var n=$.parseJSON(t.retMsg);new Dialog(8==n.status?{title:n.tip,confirmBtn:!0}:{title:n.msg,confirmBtn:!0})}else new Dialog({title:t.retMsg,confirmBtn:!0});e.removeClass("btn--wait")},error:function(){new Dialog({title:"网络异常，请刷新页面后重试",confirmBtn:!0}),e.removeClass("btn--wait")}})}else for(var i,a=spuInfo.specInfo.specMain,s=a.length,o=0;s>o;o++)if(i=a[o],!checkedSpecMap[i]||!checkedSpecMap[i].specItemId){$(window).scrollTop($(".spec-name[specId="+i+"]").offset().top);break}}),$("body").on("click",".payall-order",function(){if($(this).hasClass("btn--wait"))return!1;if(isCompleteSpec()){if(isAllowedSell()){var e=getProductParams(),t=getHashObject().source_from||3,n=getHashObject().source_type||!1,i="/order/quick/confirm";$(this).addClass("btn--wait"),window.location=webCtx+i+"?"+$.param(e,!0)+(n?"#source_type="+n:"#source_from="+t)}}else for(var a,s=spuInfo.specInfo.specMain,o=s.length,r=0;o>r;r++)if(a=s[r],!checkedSpecMap[a]||!checkedSpecMap[a].specItemId){$(window).scrollTop($(".spec-name[specId="+a+"]").offset().top);break}}),$("body").on("click",".now-buy, .second-buy,.J_laser-button",function(){if($(this).hasClass("btn--wait"))return!1;if(isCompleteSpec()){if(isAllowedSell()){var e=getProductParams(),t=getHashObject().source_from||3,n=getHashObject().source_type||!1,i=getHashObject().searchKeywordStr||!1,a=isSecondBuy?"/second-buy/confirm":"/order/quick/confirm";$(this).hasClass("J_laser-button")&&(a="/laser/confirm"),$(this).addClass("btn--wait");var s=webCtx+a+"?"+$.param(e,!0);s+=n?"#source_type="+n:"#source_from="+t,i&&(s+=s.indexOf("#")>0?"&searchKeywordStr="+i:"#searchKeywordStr="+i),window.location=s}}else for(var o,r=spuInfo.specInfo.specMain,c=r.length,d=0;c>d;d++)if(o=r[d],!checkedSpecMap[o]||!checkedSpecMap[o].specItemId){$(window).scrollTop($(".spec-name[specId="+o+"]").offset().top);break}}),$("body").on("click",".installment-buy",function(){var e=$(this);if(e.hasClass("btn--wait"))return!1;if(isCompleteSpec()){if(isAllowedSell()){e.addClass("btn--wait");var t=$("#add-num").val(),n=parseFloat($("#salePrice").val())*t,i=window.checkedSkuId;$(".j_serviceTagItem.on").each(function(){var e=parseFloat($(this).attr("svc-price"))*t;n+=e});var a=function(){var e=getProductParams(),t=getHashObject().source_from||3,n=getHashObject().source_type||!1,i=isSecondBuy?"/second-buy/confirm":"/order/quick/confirm";e.laser&&(i="/laser/confirm"),window.location=webCtx+i+"?"+$.param(e,!0)+(n?"#source_type="+n:"#source_from="+t)};$.ajax({url:webCtx+"/product/getInstallmentDataDetail",data:{skuId:i,money:n},type:"GET",success:function(t){200==t.retCode?a():(e.removeClass("btn--wait"),new Dialog({title:"分期活动已结束！",content:"请用选择其他方式支付",confirmBtn:!0,confirmText:"继续支付",confirmCallback:function(){a()},cancelBtn:!0,cancelText:"确认",cancelCallback:function(){e.removeClass("btn--wait").addClass("hidden").siblings().removeClass("hidden"),vvsDetailskuInstallment.viewHtml()}}))}})}}else for(var s,o=spuInfo.specInfo.specMain,r=o.length,c=0;r>c;c++)if(s=o[c],!checkedSpecMap[s]||!checkedSpecMap[s].specItemId){$(window).scrollTop($(".spec-name[specId="+s+"]").offset().top);break}})}function attachEventAfterRemarkContent(){var e=400;$(".evaluate-pic dd").unbind().css({display:"none",width:0,height:0}),$(".evaluate-pic").each(function(t,n){function i(){o.stop().animate({width:0,height:0},300,function(){$(this).css({display:"none"})}),a.removeClass("current")}var a=$(n).find("dt a"),s=a.size(),o=$(n).find("dd"),r=$(n).find(".J_bigImgs_box");a.on("click",function(){var t=$(this);if($(this).hasClass("current"))return i(),$(this).removeClass("current"),!1;$(this).addClass("current").siblings().removeClass("current");var n=new Image,a=w=h=0;n.src=t.attr("data-img"),$(n).load(function(){r.find("img").size()<=0&&r.html("<img>"),n.width&&(n.width>n.height?(w=n.width>e?e:n.width,h=w*n.height/n.width):(h=n.height>e?e:n.height,w=h*n.width/n.height),o.css({display:"block"}).stop().animate({width:w,height:h},300),r.children("img").attr({src:t.attr("data-img")}).animate({width:w,height:h},300))}).error(function(){a++,$(n).load(),a>3});var s=setInterval(function(){n.width&&($(n).trigger("load"),clearInterval(s))},1);return!1}),o.on("click",".target-left",function(e){var t=a.filter(".current").index();if("IMG"==e.target.tagName.toUpperCase())return i(),!1;switch($(e.target).data("paging").toUpperCase()){case"PREV":t=Math.max(--t,0),a.eq(t).hasClass("current")?a.eq(s-1).trigger("click"):a.eq(t).trigger("click");break;case"NEXT":t=Math.min(++t,s-1),a.eq(t).hasClass("current")?a.eq(0).trigger("click"):a.eq(t).trigger("click")}})})}function fetchRemarkHtml(e,t){var n=$("#remarkHandler").attr("prodId"),i=$("#onlyPicChecked").size()>0?$("#onlyPicChecked").hasClass("current"):!1,a=$(".prod-main-evaluate").empty();window.scrollTo(0,$(".prod-main-info:first").position().top),$.get(webCtx+"/product/remark",{prodId:n,onlyHasPicture:i,fullpaySkuIdSet:fullpaySkuIdSet,pageNum:e,pageSize:t},function(e){a.empty(),a.append(e),$(".pagination .go-num").unbind().on("input",function(){{var e=this.value;$(".pagination .j_go_ajax").attr("data-total")}/^\d+$/.test(e)||(this.value="")}),$evaluateMain.css("min-height",$(".prod-evaluate-wrap").outerHeight()+$(".prod-evaluate-box").outerHeight()),attachEventAfterRemarkContent()})}function isAllowedSell(){var e=!0,t=isSecondBuy?"/product/second-buy/isAllowedSell":"/product/isAllowedSell",n=getProductParams();return $.ajax({async:!1,type:"GET",url:webCtx+t,data:$.param({skuId:n.skuId,num:n.num,bSkuIds:n.bSkuIds,suiteCode:n.suiteCode,sSkuIds:n.sSkuIds},!0),success:function(t){1!=t.data?(isSecondBuy&&(window.productStore=0,setCountDownStatus()),new Dialog({title:t.msg,confirmBtn:!0}),e=!1,$(".btn--wait").removeClass("btn--wait")):$errorMsg.hide()},error:function(){new Dialog({title:"系统繁忙，请稍后重试！",confirmBtn:!0}),$(".btn--wait").removeClass("btn--wait"),e=!1}}),e}function getProductParams(e){var e=e||!1,t={},n=window.checkedSkuId,i=parseInt($("#add-num").val());i>maxNumberPerUser&&(i=maxNumberPerUser,$("#add-num").val(i));var a=[];$(".j_serviceTagItem.on").each(function(){a.push(parseInt($(this).attr("sku-id")))});var s=$(".sku-service[skuId="+checkedSkuId+"] .J_package_tags > li.on").attr("suiteCode");("undefined"==typeof s||null==s)&&(s="");var o=[];""!=s&&void 0!=s&&$(".sku-service[skuId="+checkedSkuId+"] .J_package_container").find("table[suiteCode='"+s+"'] .J_bundle_sku_box").each(function(){o.push(parseInt($(this).find(".J_bundle_sku_color span.selected").attr("bundleSkuId")))});var r=Number($("#J_skuInstallment").find(".on").attr("installmentNum"))||0;return t.skuId=n,t.num=i,$("#j_laserSelectTrigger.on").length&&(t.laser=!0,t.sourceReferUrl=location.href),e?(t.sSkuIds=a,t.suiteCode=s,t.bSkuIds=o,t.fqNum=r):(a.length>0&&(t.sSkuIds=a),""!=s&&void 0!=s&&(t.suiteCode=s),o.length>0&&(t.bSkuIds=o),r>0&&(t.fqNum=r)),t}function choiceTotal(){var e=[],t=parseFloat($("#salePrice").val()),n=$("#add-num").val();$(".spec-container .spec-item-value.on").each(function(){e.push($(this).text().trim())}),$(".sku-service[skuId="+checkedSkuId+"] .package-tags > .on").each(function(){e.push($(this).find("h2").text().trim()),t=Number($(this).attr("saleprice"))}),$(".sku-service[skuId="+checkedSkuId+"] .j_serviceTagItem.on, .spu-service .j_serviceTagItem.on").each(function(){e.push($(this).find("label").eq(0).text().replace(/¥(\d|\.)+/,"").trim()),t+=Number($(this).attr("svc-price"))}),e.push(n+"件"),t*=n,t=parseFloat(t.toPrecision(12)),t=(Math.floor(1e5*t)/1e5).toFixed(2),t==parseInt(t)&&(t=parseInt(t)),setNormalChoiceTotal(t,e),setFixedChoiceTotal(t,e)}function setNormalChoiceTotal(e,t){$("#J_choiceTotal").html('<div class="table-cell"><div class="totalPrice"><dfn>&yen;</dfn>'+e+'</div></div><div class="table-cell">已选： '+t.join("\n")+"</div>")}function setFixedChoiceTotal(e,t){$("#J_fixed_totalPrice").html("<dfn>&yen;</dfn>"+e),$("#J_fixed_totalDes").html("已选："+t.join("\n"))}function setCountDownStatus(){if(SKU.data.isEarnest||SKU.data.secondBuy){var e=$("#j_laserSelectTrigger").length&&$("#j_laserSelectTrigger").hasClass("on");switchPayMethod().then(function(t,n,i,a,s){var o=$(".primary-info[skuId="+checkedSkuId+"] .count-down-text"),r=$(".primary-info[skuId="+checkedSkuId+"] .count-down-state"),c=$(".primary-info[skuId="+checkedSkuId+"] .prod-earnest-box .time"),d={};if(isSecondBuy2iInstallment)$(".j_normalBtns[skuId="+checkedSkuId+"] .installment-buy").siblings("button").addClass("hidden");else if(this.data.isEarnest){if(1==s.flag)return void window.location.reload();d=s.dateTime,c.html("<span>"+d.d+"天 "+d.h+"时"+d.m+"分"+d.s+"秒</span>")}else if(a){var l=$(".j_normalBtns[skuId="+checkedSkuId+"] .btn-next, .prod-amount-fixed .btn-next");l.removeClass().addClass("btn-next "+t).attr("title",n).find(".btn-inner").text(n).end().siblings("button").addClass("hidden"),l.each(function(){var e=$(this);e.addClass(e.parent().hasClass("prod-amount-fixed")?"btn--sm":"btn--lg")})}if("0"!=r.attr("isOver"))switch(o.html(s.domStr),s.flag){case-1:r.text("未开始");break;case 0:r.text("秒杀中");break;case 1:r.text("秒杀结束").attr("isOver","0")}if(e){if("立即秒杀"!=n||$("#J_skuInstallment").attr("curindex"))return;$(".j_btnsLaser").show().nextAll(".j_normalBtns").hide(),$(".j_btnLaser-sm").removeClass("hidden")}else $(".j_btnsLaser").hide().next(".j_normalBtns[skuId="+checkedSkuId+"]").show(),$(".j_btnLaser-sm").addClass("hidden")})}}function formatTime(e,t,n){var i,a,s,o,r,c,d=-1;if(t>e)i=t-e,c="开始",d=-1;else{if(!(n>e))return{flag:1,domStr:"秒杀结束倒计时：<span>00</span> 天 <span>00</span> 时 <span>00</span> 分 <span>00</span> 秒"};i=n-e,c="结束",d=0}return a=parseInt(i/864e5)>9?parseInt(i/864e5):"0"+parseInt(i/864e5),s=parseInt(i/36e5)%24>9?parseInt(i/36e5)%24:"0"+parseInt(i/36e5)%24,o=parseInt(i/6e4)%60>9?parseInt(i/6e4)%60:"0"+parseInt(i/6e4)%60,r=parseInt(i%6e4/1e3)>9?parseInt(i%6e4/1e3):"0"+parseInt(i%6e4/1e3),{flag:d,domStr:"秒杀"+c+"倒计时：<span>"+a+"</span> 天 <span>"+s+"</span> 时 <span>"+o+"</span> 分 <span>"+r+"</span> 秒",dateTime:{d:a,h:s,m:o,s:r}}}function throwImg(e){var t=e[0].getBoundingClientRect(),n=$shopcart[0].getBoundingClientRect(),i=e.css("visibility","visible");i.css({position:"fixed",zIndex:"9999",left:t.left,top:t.top,width:t.right-t.left,height:t.bottom-t.top}).animate({width:50,height:50,left:(t.left+t.right)/2-25,top:(t.top+t.bottom)/2-25},function(){$(this).dequeue("verticalMove")}).animate({left:n.left},450,"linear").animate({top:n.top},{queue:"verticalMove",duration:450,easing:"easeInQuint",complete:function(){i.remove(),$document.trigger("updateShopcartNum")}})}function switchPayMethod(){var e,t,n="btn-confirm add-cart",i="加入购物车",a=!0,s=!0;return SKU.getParams().then(function(o){e=formatTime(timeLong,o.upTime,o.downTime),t=e.domStr,o.secondBuy?(a=!1,timeLong<o.upTime?(n="btn-disabled",i="未开始"):timeLong>=o.downTime?(n="btn-disabled",t="秒杀结束",i="秒杀结束"):0!=o.productStore?(n="btn-confirm second-buy",i="立即秒杀",s=!$(".j_normalBtns[skuId="+checkedSkuId+"] .btn-next").hasClass("second-buy")):(n="btn-disabled",i="已秒完",t="")):0==o.marketable?(n="btn-disabled",i="商品已下架",a=!1):0==o.productStore?2==o.storeLock?(n="reservation J-reservation2",i="立即预约",a=!1):3==o.storeLock?(n="reservation J-reservation3",i="到货通知",a=!1):(n="btn-disabled",i="商品已售罄",a=!1):1==o.fullpayFlag?(n="btn-appointment payall-order",i=bookBtnDesc,a=!1):1==o.installment&&(a=!0)}),{then:function(t){"function"==typeof t&&t.call(SKU,n,i,a,s,e)}}}function getHashObject(e){if(e=e||location.hash,!e)return{};for(var e=e.substr(1),t=e.split("&"),n={},i=0;i<t.length;++i){var a=t[i].split("=");2==a.length&&(n[a[0]]=a[1])}return n}$.fn.isOnScreen=function(){if(!this.length)return!1;var e=$(window),t={top:e.scrollTop(),left:e.scrollLeft()};t.right=t.left+e.width(),t.bottom=t.top+e.height();var n=this.offset();return n.right=n.left+this.outerWidth(),n.bottom=n.top+this.outerHeight(),!(t.right<n.left||t.left>n.right||t.bottom<n.top||t.top>n.bottom)},Vtrack(function(){Vtrack.clickStats({cfrom:5300,pageview:"商品详情页",goodid:window.checkedSkuId,goodtype:commodityType,cid:Vtrack.parseQs().cid||Vtrack.getLocalData("vfe-cid")||"",is_done:1}),$(window).on("beforeunload",function(){Vtrack.clickStats({cfrom:5300,pageview:"商品详情页",lefttime:+new Date})})},function(){console.warn("失败")}),$("#side-bar").on("mouseup","li",function(){var e=$(this).attr("data-name"),t=$(this).attr("data-index");Vtrack.clickStats({cfrom:5301,pageview:"商品详情页",name:e,position:t})});var isDoneBanner=1,isDonecoupon=1,isDonePromotion=1,isDownRecommend=1;$(window).on("scroll",function(){var e=$(".tab-information"),t=e.isOnScreen();t&&isDoneBanner&&(Vtrack.clickStats({cfrom:5306,pageview:"商品详情页",name:e.attr("data-name"),tab_id:e.attr("data-index"),page_id:""}),isDoneBanner=0);var n=$(".J-coupon-enter"),i=n.isOnScreen();i||(isDonecoupon=1),i&&isDonecoupon&&(Vtrack.clickStats({cfrom:5316}),isDonecoupon=0);var a=$(".summary-promotion"),s=a.isOnScreen();s||(isDonePromotion=1),s&&isDonePromotion&&(Vtrack.clickStats({cfrom:5318}),isDonePromotion=0)}).trigger("scroll"),$("body").on("click",".add-cart, .now-buy, .second-buy, .J_laser-button, .btn-appointment, .installment-buy, .reservation",function(){var e=$(this);if(e.hasClass("add-cart")){var t=2;e.parent().hasClass("prod-amount-fixed")&&(t=1),Vtrack.clickStats({cfrom:5302,pageview:"商品详情页",position:t})}else{var n=localStorage.getItem("login_flag_tmp");n&&Vtrack.setLocalData("login_flag",n,!1,!0),Vtrack.clickStats({cfrom:5303,pageview:"商品详情页",name:$.trim(e.text()),login_flag:localStorage.getItem("login_flag_tmp")||""})}}),String.prototype.trim=function(){return $.trim(this)},window.productStore=window.productStore||0;var spuId=window.spuId||"",checkedSkuId=window.defaultSkuId||"",webCtx=window.webCtx||"",IMGHOSTURL=window.IMGHOSTURL||"",passportLoginUrlPrefix=window.passportLoginUrlPrefix||"",imgHost=window.imgHost||"",showBuyNow=window.showBuyNow||"0",showBuyNow=1==showBuyNow,fullpaySkuIdSet=window.fullpaySkuIdSet||"",maxNumberPerUser=window.normalMaxNum||5,isSecondBuy=window.isSecondBuy||!1,isDeposit="1"==window.depositFlg,intervalId=null,timeLong=+window.timeLong||0,timeDevition=(new Date).getTime()-timeLong,uptimeLong=window.uptimeLong||0,downtimeLong=window.downtimeLong||0,isSecondBuy2iInstallment=!1,$errorMsg=null,$document=$(document),$shopcart=null,dialogModel=function(e,t,n,i,a){new Dialog({title:e,content:t,icon:n,confirmBtn:!0,cancelBtn:i,confirmCallback:a})},SPU={marketable:!1,secondBuy:!1,isDeposit:isDeposit,skuFavouriteList:[],init:function(){this.getParams(),this.initCollectList(window.spuId)},getParams:function(){this.secondBuy=window.isSecondBuy||!1,this.marketable=""},initCollectList:function(e){var t=this;$.ajax({type:"GET",dataType:"json",url:webCtx+"/favorite/listMemberFavorite",data:{spuId:e,goodsType:0},success:function(e){0==e.code&&(t.skuFavouriteList=e.data,refreshCollectState())}})},addCollectSku:function(e){this.skuFavouriteList.indexOf(e)<0&&this.skuFavouriteList.push(e)},removeCollectSku:function(e){var t=this.skuFavouriteList.indexOf(e);t>=0&&this.skuFavouriteList.splice(t,1)}},SKU={elemWrap:null,elems:null,data:{id:0,productStore:0,marketable:!1,secondBuy:!1,installment:!1,fullpayFlag:!1,upTime:0,downTime:0},init:function(){this.data.marketable=SPU.marketable,this.data.secondBuy=SPU.secondBuy,this.getParams()},getParams:function(){var e=$(".primary-info[skuId="+checkedSkuId+"]"),t=window.checkedSkuId,n=0,i=0,a="1"==e.attr("skuinstallment"),s="0"!=e.attr("sku-fullpay"),o=e.attr("skuStore"),r=e.attr("sku-storelock"),c="true"==e.attr("isEarnest");return SPU.secondBuy&&(n=spuInfo.skuSecInfos[t].upTime,i=spuInfo.skuSecInfos[t].downTime),c&&(i=e.find(".prod-earnest-box").attr("endTime"),i=new Date(i).getTime()),$.extend(SKU.data,{id:t,productStore:o,fullpayFlag:s,installment:a,storeLock:r,upTime:n,downTime:i,isEarnest:c}),this},then:function(e){"function"==typeof e&&e.call(this,this.data)}},conponDoing=!1,couponPop={},couponCallback=function(){conponDoing=!1,$(".J-receive").off("click").on("click",function(){if(!conponDoing){conponDoing=!0;var e=$(this),t=e.attr("data-uuid");receiveCoupon(t,e)}}),$(".card-rule-explain").off("click").on("click",function(){$(this).closest(".card-rule-box").find(".rule-explain-box").toggle()})},getUserCoupon=function(e){couponPop[e]?(couponPop[e].show(),conponDoing=!1):$.ajax({type:"get",dataType:"json",data:{spuId:spuId,skuId:e},url:webCtx+"/coupon/getUserCoupon",success:function(t){if(t&&200==t.retCode){var n=template("couponTpl",t.data);couponPop[e]=new Dialog({width:942,title:"领取优惠券",content:n}),$(".coupon-wrap").find("[data-amount]").each(function(){var e=$(this),t=e.attr("data-amount")+"";t.length>4&&e.addClass("money-value-small"),e.removeAttr("data-amount")}),couponCallback()}},error:function(){conponDoing=!1}})};$(".J-coupon-enter").on("click",function(){conponDoing||(conponDoing=!0,getUserCoupon(checkedSkuId),Vtrack.clickStats({cfrom:5317}))});var reservation=function(e){var t=new Dialog({width:494,title:3==e?"到货通知":"立即预约",content:$("#enrollmentTpl").html(),closeCallback:function(){$(this.$El).remove()}}),n=$("#reserveWarp"),i=n.find(".phone"),a=n.find(".err-tip"),s=n.find(".btn"),o="";i.on("keyup",function(){o=$.trim($(this).val()),s[""==o?"addClass":"removeClass"]("disabled"),a.text(""==o?"请输入正确的手机号码":"")}),s.on("click",function(){$(this).hasClass("disabled")||(/^(1[3456789][0-9]{9})$/.test(o)?(s.text("提交中...").addClass("disabled"),reserveSubmit(e,o,t)):a.text("请输入正确的手机号码"))})};$("#content").on("click",".J-reservation2,.J-reservation3",function(){var e=$(this).hasClass("J-reservation2")?2:3;reservation(e)});var vvsDetailskuInstallment={viewHtml:function(){var e=this,t=$("#add-num").val(),n=window.checkedSkuId,i=parseFloat($("#salePrice").val())*t;$(".sku-service[skuId="+n+"] .j_serviceTagItem.on").each(function(){var e=parseFloat($(this).attr("svc-price"))*t;i+=e}),e.getData(n,parseFloat(i))},getData:function(e,t){var n=this;return $.ajax({url:webCtx+"/product/getInstallmentDataDetail",data:{skuId:e,money:t},type:"GET",success:function(e){if(200==e.retCode&&e.antInstallment){var t=e.antInstallment,i=$(".primary-info[skuId="+checkedSkuId+"]").attr("installmentIndex");n.setDom(t),$("#installment_dt,#j_installment").show(),$(".server-support [data-id=detail0]").show(),void 0!=i&&$("#J_skuInstallment li").eq(i).trigger("click")}else $("#installment_dt,#j_installment").hide(),$(".server-support [data-id=detail0]").hide()}}),null},setDom:function(e){var t=$("#J_skuInstallment"),n=e.perInstallmentInfoList,i="";t.attr("curIndex",""),$.each(n,function(e,t){i+=['<li class="" installmentNum="'+t.num+'">','	<p class="pkg-title"><dfn>&yen;</dfn>'+t.perPay+" x "+t.num+"期</p>",t.userPerFeePay>0?'<h2 class="pkg-price">（手续费<dfn>&yen;</dfn>'+t.userPerFeePay+"/期）</h2>":'<h2 class="pkg-price">（无息）</h2>','	<i class="prod-param-checked"></i>',"</li>"].join("\n")}),t.html(i)}},LaserUtil={initView:function(e){var t=this;$.ajax({url:webCtx+"/laser/detail",data:{skuId:e},success:function(e){200==e.retCode?($(".laser-option").show(),t.switchSelectedStatus(!1)):($(".laser-option").hide(),$("#j_laserSelectTrigger").removeClass("on"),t.switchSelectedStatus(!1))}})},switchSelectedStatus:function(e){$(".j_activity_btns").is(":hidden")&&!$(".reservation:visible").length&&($(".j_normalBtns[skuId="+checkedSkuId+"]").find("button:visible").hasClass("btn-disabled")||(e?($("#j_laserSelectTrigger").addClass("on"),$(".laser-option-tips").show(),$(".j_btnsLaser").show(),$(".j_btnLaser-sm").removeClass("hidden"),$(".prod-amount-fixed .btn-next").hide(),$(".j_normalBtns").hide(),SKU.data.isEarnest?$("#j_laserTips").show():$("#j_laserTips").hide()):($("#j_laserSelectTrigger").removeClass("on"),$(".j_btnsLaser").hide(),$(".laser-option-tips").hide(),$(".j_btnLaser-sm").addClass("hidden"),$(".j_normalBtns[skuId="+checkedSkuId+"]").show().siblings(".j_normalBtns").hide(),$(".prod-amount-fixed .btn-next").show())))},initEvent:function(){var e=this;$("#j_laserInfoTrigger").length&&($("#j_laserInfoTrigger").hover(function(){$("#j_laserInfoPop").fadeIn("fast")},function(e){e.relatedTarget==$("#j_laserInfoPop")[0]||$(e.relatedTarget).closest("#j_laserInfoPop").length||$("#j_laserInfoPop").fadeOut("fast")}),$("#j_laserInfoPop").on("mouseleave",function(e){e.relatedTarget==$("#j_laserInfoTrigger")||$(e.relatedTarget).closest("#j_laserInfoTrigger").length||$("#j_laserInfoPop").fadeOut("fast")})),$("#j_laserSelectTrigger").click(function(){$(this).toggleClass("on"),e.switchSelectedStatus($(this).hasClass("on"))})}};$(function(){SPU.init(),SKU.init(),refreshMaxNum(),$errorMsg=$("#error-msg"),$shopcart=$("#side-bar .shopcart"),(SPU.secondBuy||SPU.isDeposit)&&(setCountDownStatus(),intervalId=setInterval(function(){timeLong=(new Date).getTime()-timeDevition,setCountDownStatus()},1e3)),void function(){~function(){if(0==$(".gift-item").size())return!1;var e=['<div class="giftItem-panel hidden " id="J_giftItemPanel" >',"	<table >","		<tr>","			<td >","				<a>","					<img>","				</a>","				<h3></h3>","				<p></p>","			</td>","		</tr>","	</table>","</div>"].join("\n"),t=$(e),n=t.find("a")[0],i=t.find("img")[0],a=t.find("h3")[0],s=t.find("p")[0];
t.appendTo("body"),t.css("visibility","hidden"),t.timer=null,$(".gift-item").on({mouseenter:function(){var e=$(this),o=e.offset(),r=e.attr("spu-id"),c=e.attr("sku-id"),d=e.attr("sku-name"),l=e.attr("sku-salePrice"),u=e.attr("sku-smallPic");n.href=r+"?colorSkuid="+c,n.target="_blank",i.src=u,a.innerHTML=d,s.innerHTML=l>0?"<dfn>&yen;</dfn>"+l:"",clearTimeout(t.timer),t.stop(!0,!0).animate({top:o.top+$(this).height()+15,left:o.left-t.outerWidth(!0)/2+e.width()/2-8},150,function(){$(this).stop(!0).css("visibility","visible").fadeIn(150)})},mouseleave:function(){t.timer=setTimeout(function(){t.stop(!0).fadeOut(150)},400)}}),t.on({mouseenter:function(){clearTimeout(t.timer)},mouseleave:function(){t.timer=setTimeout(function(){t.stop(!0).fadeOut(150)},150)}})}(),previewFixed(),initSwitch(),SKU.data.isEarnest||vvsDetailskuInstallment.viewHtml(),$.ajax({type:"GET",dataType:"json",url:webCtx+"/favorite/count",data:{spuId:spuId,goodsType:0},success:function(e){200==e.retCode&&$("#favCount").text(e.retMsg)}}),$("#j_CollectTrigger").parent().on("click",function(){if(!LoginConfirm.isLogin())return void LoginConfirm.redirect();var e=$(this),t=checkedSkuId;return e.hasClass("collected")?($.ajax({data:{skuId:t,goodsType:0},type:"POST",dataType:"json",url:webCtx+"/my/favorite/remove",success:function(t){200==t.retCode?(SPU.removeCollectSku(checkedSkuId),$("#favCount").text(parseInt($("#favCount").text())-1),e.addClass("collect").removeClass("collected")):500==t.retCode&&dialogModel("失败","您已经取消收藏过此商品，请刷新重试！","warning")}}),!1):void $.ajax({data:{skuId:t,goodsType:0},type:"POST",dataType:"json",url:webCtx+"/my/favorite/add",success:function(t){200==t.retCode?(SPU.addCollectSku(checkedSkuId),e.removeClass("collect").addClass("collected"),$("#favCount").text(parseInt($("#favCount").text())+1)):dialogModel("失败","您已经收藏过此商品，请刷新重试！","warning")},error:function(){LoginConfirm.redirect()}})}),$("#J_Share a").each(function(){var e=$(this).attr("href");$(this).attr("href",encodeURI(e))}),$("#J_Share").hover(function(){$(this).find(".v-share-box").stop(!0,!0).fadeIn()},function(){$(this).find(".v-share-box").stop(!0,!0).fadeOut()})}(),void function(){function e(e){$.ajax({type:"get",dataType:"json",url:webCtx+"/product/getCommodityPostList?t="+ +new Date,data:{spuId:spuId,pageNum:e,pageSize:10,preview:$("#preview").val()},success:function(e){if(e&&200==e.retCode&&(e.total>0&&($(".tab-evaluation").show().data("data-pageNum",e.pageNum),e.pageNum>1&&Vtrack.clickStats({cfrom:5304,pageview:"商品详情页",name:"评测",tab_id:4,page_id:e.pageNum})),1==e.total&&n(e.postList[0].id,1),e.total>1)){var i=template("reviewTpl",{lists:e.postList});$("#reviewList").html(i);for(var a=document.querySelector("#reviewList").children,s=0;s<a.length;s++){var o=a[s].children[1],r=a[s].children[2];$clamp(o,{clamp:1}),$clamp(r,{clamp:2})}t(e.pageNum,e.totalPage)}}})}function t(t,n){m?($("html,body").animate({scrollTop:$(".prod-main-info").offset().top},0),m.render(t)):m=new vivoPage("#page",t,n,function(t){e(t)})}function n(e,t){$.ajax({type:"get",dataType:"json",url:webCtx+"/product/getCommodityPostDetail?t="+ +new Date,data:{id:e,preview:$("#preview").val()},success:function(n){if(n&&200==n.retCode){if(1==t)i=n.post;else{var n=n.post,a=$(".evaluation-dialog-box"),s=$(".prod-main-info .prod-main-box"),o=$(".evaluation-dialog-from");if(a.find("h1").text(n.postTitle),a.css("display","block").find(".cut").html(n.message),s.css("z-index",999),$("html,body").css("overflow-y","hidden"),a.find("img").each(function(){var e=$(this),t=e.attr("file");t&&e.attr("src",t)}),n.source)o.hide();else{var r="本文转自vivo社区";n.author&&(r+=" 作者："+n.author),o.text(r)}a.find(".evaluation-dialog").scrollTop(0)}Vtrack.clickStats({cfrom:5305,pageview:"商品详情页",goodid:spuId,goodtype:parseInt(document.getElementById("pageNavMappingIndex").value)+1,pingce_id:e})}}})}var i,a=$(".prod-main-info"),s=a.find(".prod-tab-box ul li"),o=a.find(".prod-main-box"),r=0,c=a.offset().top,d=a.find(".prod-main-tab"),l=d.find(".thumb-goods"),u=(d.find(".prod-amount-fixed"),!1);$.ajax({type:"POST",dataType:"json",url:webCtx+"/product/countRemark",data:{spuId:spuId,fullpaySkuIdSet:fullpaySkuIdSet},success:function(e){$("#remarkCountSpan").text(" ("+e.remarkCount+") ")}});var p=1;$(".tab-evaluation").on("click",function(){var e=$(".prod-main-evaluation div.wrapper");if("object"==typeof i&&1==i.isView&&i.message.length>0&&1==p){var t='<div class="evaluation-tit-info"><h3>'+i.postTitle+"</h3>";if(!i.source){var n="本文转自vivo社区";i.author&&(n+=" 作者："+i.author),t+="<p>"+n+"</p>"}t+="</div>",e.html(t+i.message),p=0}});var f=document.getElementById("promotionWords");$clamp(f,{clamp:3}),$(".evaluation-info").on("click",".evaluation-info-list",function(){var e=$(this).attr("data-id");n(e)}),$(".evaluation-dialog-box .extra-icon").on("click",function(){$(".evaluation-dialog-box").css("display","none"),$(".prod-main-info .prod-main-box").css("z-index",1),$("html,body").css("overflow-y","auto")}),"1"==commodityType&&e(1);var m;$("#remarkHandler").click(function(){u||fetchRemarkHtml(),u=!0}),$("body").on("click",".btn-evaluator",function(){!LoginConfirm.isLogin()&&LoginConfirm.redirect();var e=spuId;$.ajax({type:"POST",dataType:"json",url:webCtx+"/my/remark/addRemarkVerify",data:{prodId:e},success:function(e){200==e.retCode?window.location.href=webCtx+"/my/remark/unRemark-prod":700==e.retCode?dialogModel("失败",e.retMsg,"warning"):710==e.retCode?dialogModel("失败",e.retMsg,"warning"):600==e.retCode?LoginConfirm.redirect():dialogModel("失败","系统错误！","warning")}})}),$("body").on("click",".evaluate-toolbar li",function(){$(this).hasClass("current")||($(this).addClass("current").siblings().removeClass("current"),fetchRemarkHtml())}),$("body").on("click",".pagination .j_go_ajax",function(){var e=($(this).attr("data-url"),$(this).attr("data-total")),t=$(this).attr("pageSize"),n=$(this).parent().find("input").val();n&&/^\d+$/.test(n)&&parseInt(n)<=e&&fetchRemarkHtml(n,t)}),s.on({click:function(){return $(this).hasClass("current")?!1:($(this).addClass("current").siblings().removeClass("current"),0>=r&&$("body,html").animate({scrollTop:c+1},1),o.find(".prod-main-"+$(this).attr("v")).css({display:"block"}).siblings().css({display:"none"}),Vtrack.clickStats({cfrom:5304,pageview:"商品详情页",name:$(this).attr("data-name"),tab_id:$(this).attr("data-index"),page_id:$(this).attr("data-pageNum")||1}),!1)}}),$(window).on({load:function(){$(this).trigger("scroll")},scroll:function(){r=a[0].getBoundingClientRect().top,0>=r?(a.css({paddingTop:81}),d.addClass("fixed"),l.show()):(a.css({paddingTop:0}),d.removeClass("fixed"),l.hide())}})}(),void function(){var e=function(e){e.hasClass("disabled")||e.addClass("disabled")},t=function(e){e.hasClass("disabled")&&e.removeClass("disabled")},n={flash:function(){var e=0,t=setInterval(function(){return 5==e?(clearInterval(t),void($("#order-num-msg").hasClass("red")&&$("#order-num-msg").toggleClass("red"))):($("#order-num-msg").toggleClass("red"),void e++)},300)}},i=$("#add-num").val();i&&parseInt(i)>1&&$("#dec").removeClass("disabled"),$("#inc").click(function(){var e=parseInt($("#add-num").val());return e>=maxNumberPerUser?void n.flash():($("#add-num").val(e+1),e+1>1&&t($("#dec")),vvsDetailskuInstallment.viewHtml(),void choiceTotal())}),$("#dec").click(function(){if($(this).hasClass("disabled"))return!1;var n=parseInt($("#add-num").val());1>=n||(t($(this)),$("#add-num").val(n-1),1>=n-1&&e($(this)),vvsDetailskuInstallment.viewHtml(),choiceTotal())})}(),void function(){$(".sku-service .J_bundle_sku_box").each(function(){if(0==$(this).find("span.J_enable").size()){var e=$(this).parents(".J_suite_table").attr("suiteCode");$(this).closest(".package-box").find(".J_package_tags").find("li[suiteCode='"+e+"']").addClass("disabled")}else $(this).find("span.J_enable:first").addClass("selected")}),$("body").on("click",".package-tags li",function(){if($(this).hasClass("disabled"))return!1;$(this).addClass("on").siblings().removeClass("on"),$("#salePrice").val(parseFloat($(this).attr("salePrice"))),SKU.data.isEarnest?($("#installment_dt, #j_installment").hide(),$(".server-support [data-id=detail0]").hide()):vvsDetailskuInstallment.viewHtml(),choiceTotal();var e=$(this).attr("suiteCode"),t=$(this).closest(".package-box").find(".package-container");if(void 0==e)return void t.hide();t.show();var n=t.find("table[suiteCode='"+e+"']");n.show().siblings().hide(),n.find(".ancillary-prod").each(function(){var e=$(this).find(".color-box");changeSuiteSkuPic(e)})}),$("body").on("click",".color-box span",function(){$(this).hasClass("selected")||($(this).addClass("selected").siblings().removeClass("selected"),changeSuiteSkuPic($(this).parent()))})}(),prodBtns()});var checkedSpecMap={};$(function(){initChedkedSpecs(),refreshSpecState(),refreshSpecStoreState(),$(".spec-container").on("click",".spec-item-value",function(){var e=$(this).closest(".spec-item"),t=e.attr("specId"),n=e.attr("specName"),i=$(this).attr("specItemId"),a=$(this).attr("specItemName");if(Vtrack.clickStats({cfrom:5342,style:n,style_detail:a}),!$(this).hasClass("disabled")&&!$(this).hasClass("on")){if($(this).addClass("on").siblings().removeClass("on"),$(this).closest(".spec-item").prev(".spec-name").find(".tip").hide(),checkedSpecMap[t]={specItemId:i,specItemName:a},isCompleteSpec()){var s=combUId(),o=spuInfo.specInfo.skuMap[s];o?(window.checkedSkuId=o,refreshInfo(o),Vtrack.clickStats({cfrom:5300,pageview:"商品详情页",goodid:window.checkedSkuId,goodtype:commodityType,cid:Vtrack.parseQs().cid||Vtrack.getLocalData("vfe-cid")||"",is_done:1})):($(this).closest(".spec-item")[0]===$(".spec-item:first-of-type")[0]&&(checkedSpecMap={},$(".spec-item:not(:first-of-type) .spec-item-value").removeClass("on"),$(".spec-item:not(:first-of-type)").prev(".spec-name").find(".tip").show()),checkedSpecMap[t]={specItemId:i,specItemName:a})}refreshSpecState(),refreshSpecStoreState()}}),$(".service-tags > .service-tags-item").mouseenter(function(){$(this).addClass("chgstat")}).mouseleave(function(){$(this).removeClass("chgstat")});var e=function(){$(".J-service-checkbox .checkbox")[$(".services-box .service-tags>li.on").length>0?"addClass":"removeClass"]("checked")};e(),$(".service-tags").each(function(){var t=$(this),n=t.attr("data-type"),i=t.find(".j_serviceTagItem");i.on("click",function(){var i=$(this);"radio"==n?t.siblings(".service-tags").find(".j_serviceTagItem").removeClass("on"):$('.services-box .service-tags[data-type="radio"] .j_serviceTagItem').removeClass("on"),i.siblings().removeClass("on"),i.toggleClass("on"),vvsDetailskuInstallment.viewHtml(),choiceTotal(),e()}).on("selectstart",!1)}).find(".icon-ask-fine").hover(function(){$(this).closest(".j_serviceTagItem").find(".service-tip").show()},function(){$(this).closest(".j_serviceTagItem").find(".service-tip").hide()}),$(".J-service-checkbox").on("click",function(){var e=$(this),t=e.find(".checkbox");t.toggleClass("checked"),t.hasClass("checked")||$(".j_serviceTagItem.on").removeClass("on"),choiceTotal()});var t=null,n=function(e){$(".term-tab>li").eq(e).addClass("active").siblings().removeClass("active"),$(".term-item").eq(e).show().siblings().hide(),$(".vivo-terms-box").scrollTop(0)};$(".J-vivoCareTerms").on("click",function(){var e=0,i="broken",a=$(this).attr("data-total"),s={broken:"《碎屏宝服务条款》",extend:"《延保服务条款》",backCover:"《后盖宝服务条款》",vivoCare:"《vivo care服务条款》"},o=$(".services-box .service-tags li"),r=o.filter(".on").parent();r.length?(e=r.index(),i=r.attr("data-index")):i=o.parent().eq(0).attr("data-index"),t?(t.show(),n(e)):t=new Dialog({width:976,title:a>1?"《vivo 服务条款》":s[i],content:template("vivoTermsTpl",{index:i}),confirmBtn:!0,confirmText:"我已阅读",confirmCallback:function(){$(".J-service-checkbox .checkbox").addClass("checked")}}),$(".term-tab>li").off("click").on("click",function(){var e=$(this).index();n(e)})});var i=$("#J_skuInstallment");i.on("click","li",function(){{var e=$(this);$(".j_normalBtns[skuId="+checkedSkuId+"] .installment-buy")}e.toggleClass("on").siblings().removeClass("on"),$(".j_normalBtns[skuId="+checkedSkuId+"]").find("button:visible").hasClass("btn-disabled")||isShortage(checkedSkuId)||switchPayMethod().then(function(){e.hasClass("on")?(SPU.secondBuy&&(isSecondBuy2iInstallment=!0),$(".primary-info[skuId="+checkedSkuId+"]").attr("installmentIndex",e.index()),$(".j_activity_btns").show(),$(".prod-amount-fixed .installment-buy").show(),$(".j_normalBtns").hide(),$(".prod-amount-fixed .btn-next").hide(),$(".j_btnsLaser").hide(),$(".j_btnLaser-sm").addClass("hidden")):(i.removeAttr("curIndex"),$(".primary-info[skuId="+checkedSkuId+"]").removeAttr("installmentIndex"),$(".j_normalBtns[skuId="+checkedSkuId+"]").show(),$(".prod-amount-fixed .btn-next").show(),$(".j_activity_btns").hide(),$(".prod-amount-fixed .installment-buy").hide(),SPU.secondBuy&&(isSecondBuy2iInstallment=!1),LaserUtil.switchSelectedStatus($("#j_laserSelectTrigger").hasClass("on")&&$("#j_laserSelectTrigger").is(":visible")))})}),initRecommendEvent(),LaserUtil.initEvent(),LaserUtil.initView(checkedSkuId)}),Array.prototype.each=function(e){e=e||Function.K;for(var t=[],n=Array.prototype.slice.call(arguments,1),i=0;i<this.length;i++){var a=e.apply(this,[this[i],i].concat(n));null!=a&&t.push(a)}return t},Array.prototype.uniquelize=function(){for(var e=new Array,t=0;t<this.length;t++)e.indexOf(this[t])>-1||e.push(this[t]);return e},Array.prototype.intersect=function(e,t){return e.uniquelize().each(function(e){return t.indexOf(e)>-1?e:null})};var saleProp=spuInfo.specInfo.specMain,salePropSeq=spuInfo.specInfo.specItemSeq,$evaluateMain=$(".prod-main-evaluate");choiceTotal();